# LexMess: план работ после R22 (R23+)

Текущий статус: завершены R1–R12 и R13–R22 (auth+кошелёк+recovery+push+оффлайн+стего+WebRTC MVP+операционка).

Ниже — следующий “боевой” план (R23…): сначала UX/навигация, затем кошелёк (переводы/вывод), затем админка/безопасность/релиз.

---

## R23 — Единый UI-каркас (header + bottom tabs)
**Цель:** на каждом экране одинаковый верхний хедер (заголовок + назад), и нижний навбар с иконками.
- RootStack + TabNavigator (Чаты / Комнаты / Кошелёк / Профиль).
- `AppHeader` компонент: title, back, action buttons.
- Нормальные safe-area отступы, единые размеры иконок/шрифтов.
**Критерий готовности:** все основные экраны открываются через Tabs, “назад” работает предсказуемо.

## R24 — Темы и графика (design system)
**Цель:** аккуратная визуальная система: светлая/тёмная тема + акцентные палитры стилей комнат.
- `theme.ts`: colors/spacing/radius/typography/shadows.
- Переключатель темы в настройках + авто по системе.
- Единые компоненты: Button, Input, Card, ListItem, Badge, Modal.
**Критерий:** приложение выглядит цельно, без “разнобоя”, все экраны в одной стилистике.

## R25 — Улучшенный личный кабинет (Profile)
**Цель:** “личный кабинет” как центр управления аккаунтом.
- Профиль: avatar, display_name, login (read-only), wallet address.
- Безопасность: recovery status, смена пароля, logout-all (уже есть) — красиво упаковать.
- Приватность: скрывать login в комнатах, показывать только display_name.
**Критерий:** всё управление аккаунтом из одного места.

---

# Кошелёк: переводы и вывод

## R26 — Кошелёк: UX/данные (нормальный баланс и история)
- Кэш баланса/tx, пагинация истории, pull-to-refresh.
- Статусы транзакций: pending/confirmed/failed.
- QR-код адреса, “Скопировать”, “Поделиться”.
**Критерий:** кошелёк пригоден для ежедневного просмотра.

## R27 — Переводы (Send EIN) — MVP
**Главный выбор архитектуры:**
- **Custodial MVP:** сервер подписывает/отправляет tx (быстрее внедрить, но сервер = риск).
- **Non-custodial:** ключи на устройстве (Keystore), tx подписывается клиентом (правильнее, сложнее).
**В этом релизе:** custodial MVP + дорожка на non-custodial.
- UI: Send → адрес/сумма → комиссия/итого → Confirm.
- Валидация адреса, минимальная сумма, лимиты.
- API: `POST /v1/wallet/send` (amount, to_address, memo, idempotency_key).
- DB: `wallet_ops` (idempotency, status, error, chain_tx_id).
**Критерий:** можно перевести EIN на другой адрес и увидеть tx в истории.

## R28 — Запрос на вывод средств (withdraw request) + минималка
**Цель:** пользователь создаёт заявку, система/админ обрабатывает.
- UI: Withdraw → сумма (>= MIN_WITHDRAW) → реквизиты (адрес/сеть/метод) → Confirm.
- DB: `withdraw_requests` (user_id, amount, method, details_json, status, created_at, processed_at).
- API:
  - `POST /v1/withdraw/request`
  - `GET /v1/withdraw/list`
- Админ (web): список заявок, approve/reject, комментарии.
**Критерий:** заявка создаётся, видно статус, есть минималка и лимиты.

## R29 — Безопасность операций кошелька
- PIN/биометрия на “Send/Withdraw”.
- Анти-спам: rate limit на операции, cooldown, блокировки при подозрительной активности.
- Логи с request-id + аудит: кто/когда/что отправил.
**Критерий:** операции защищены и трассируются.

---

# Мессенджер: качество, удобство, фичи

## R30 — Список чатов/комнат: нормализация и UX
- Превью сообщения, unread, закрепы, поиск.
- “Системные” события: приглашение, смена названия/стиля комнаты.
**Критерий:** список чатов работает как в нормальном мессенджере.

## R31 — Медиа/голос/файлы: стабильный пайплайн
- Единая загрузка/кеш, прогресс, ретраи.
- Ограничения: размер, типы, политика комнаты (allow_media/voice/files).
**Критерий:** отправка медиа не ломает UX.

## R32 — WebRTC: шаг к продакшену
- TURN конфиг, стабильный signaling, reconnect.
- Экран звонка: таймер, mute, speaker, video toggle.
**Критерий:** звонки не “падают” при плохой сети.

## R33 — Push: события кошелька + приглашения + упоминания
- Push на: входящее сообщение, инвайт, статус вывода, входящий перевод.
**Критерий:** ключевые события приходят без открытия приложения.

---

# Завершение релиза

## R34 — Продакшен-полиш + релиз-пайплайн
- Crash reporting (по желанию), строгие логи, профилирование.
- Fastlane/подписи, сборка release, чеклист публикации.
- Документация: переменные окружения, миграции, бэкапы, мониторинг.
**Критерий:** можно повторяемо деплоить и собирать релиз.

---

## Приоритет (если делать “самое нужное”)
1) R23–R25 (UI каркас + темы + кабинет)  
2) R27–R29 (переводы + вывод + защита)  
3) R30 (список чатов/поиск/unread)  
4) остальное по мере роста



## Выполнено

- v58: R29 — PIN/биометрия на Send/Withdraw, серверные лимиты 24h, аудит отказов.
